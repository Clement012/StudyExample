<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pokemon Battle</title>
  <style>
    body {
      background: linear-gradient(135deg, #e0f7fa, #80deea);
      font-family: 'Poppins', sans-serif;
      color: #333;
      margin: 0;
      padding: 0;
    }

    h1 {
      font-size: 36px;
      margin-bottom: 20px;
      color: #00796b;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .container {
      max-width: 900px;
      margin: 50px auto;
      padding: 20px;
      text-align: center;
      background-color: #ffffff;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      border-radius: 12px;
    }

    .input-box {
      margin: 20px 0;
      display: flex;
      justify-content: center;
      gap: 15px;
    }

    input {
      padding: 10px;
      font-size: 16px;
      border: 2px solid #00796b;
      border-radius: 8px;
      width: 180px;
    }

    input:focus {
      outline: none;
      border-color: #004d40;
    }

    button {
      padding: 12px 24px;
      font-size: 16px;
      background-color: #00796b;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #004d40;
    }

    .character-box {
      display: flex;
      justify-content: space-around;
      margin-top: 40px;
      transition: opacity 1s ease-in;
      opacity: 0;
    }

    .character-card {
      background-color: #b2dfdb;
      border-radius: 12px;
      padding: 20px;
      width: 400px;
      height: auto;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      text-align: center;
      transition: transform 0.3s ease;
    }

    .character-card:hover {
      transform: translateY(-10px);
    }

    .character-card h2 {
      font-size: 24px;
      margin-bottom: 10px;
      color: #004d40;
    }

    .character-card img {
      width: 120px;
      height: 120px;
      margin-bottom: 10px;
      border-radius: 50%;
      border: 4px solid #004d40;
      background-color: white;
    }

    .character-stats {
      list-style: none;
      padding: 0;
      margin: 20px 0;
      font-size: 16px;
    }

    .hp-bar-container {
      width: 100%;
      height: 24px;
      background-color: #ffffff;
      border-radius: 12px;
      overflow: hidden;
      border: 2px solid #004d40;
      position: relative;
      margin-top: 10px;
    }

    .hp-bar {
      height: 100%;
      background-color: #ff5252;
      transition: width 0.5s ease;
    }

    .hp-text {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      color: #004d40;
      font-weight: bold;
    }

    .battle-log {
      margin-top: 30px;
      background-color: #fff3e0;
      padding: 20px;
      border: 1px solid #ffcc80;
      border-radius: 8px;
      font-size: 16px;
      text-align: left;
    }

    @media (max-width: 768px) {
      .character-box {
        flex-direction: column;
        align-items: center;
      }

      .character-card {
        width: 100%;
        margin-bottom: 20px;
      }
    }
  </style>
</head>
<body>
  <div id="app" class="container">
    <h1>Pokemon Battle Simulator</h1>

    <div class="input-box" v-show="showInputBox">
      <input type="number" v-model="character1Id" placeholder="Enter Character 1 ID">
      <input type="number" v-model="character2Id" placeholder="Enter Character 2 ID">
      <button @click="fetchCharacters">Submit</button>
    </div>

    <div class="character-box" :style="{ opacity: showCharacterBox ? 1 : 0 }">
      <!-- Character 1 -->
      <div v-if="character1" class="character-card">
        <div class="hp-bar-container">
          <div class="hp-bar" :style="{ width: character1HPPercentage + '%' }"></div>
          <div class="hp-text">{{ character1HPPercentage }}%</div>
        </div>
        <h2>{{ character1.name.chinese }}</h2>
        <img :src="getImageUrl(character1.image)" alt="Character 1 Image">
        <ul class="character-stats">
          <li>HP: {{ character1CurrentHP }} / {{ character1.base.HP }}</li>
          <li>Attack: {{ character1.base.Attack }}</li>
          <li>Defense: {{ character1.base.Defense }}</li>
          <li>Speed: {{ character1.base.Speed }}</li>
        </ul>
        <button @click="attackCharacter2">Attack</button>
      </div>

      <!-- Character 2 -->
      <div v-if="character2" class="character-card">
        <div class="hp-bar-container">
          <div class="hp-bar" :style="{ width: character2HPPercentage + '%' }"></div>
          <div class="hp-text">{{ character2HPPercentage }}%</div>
        </div>
        <h2>{{ character2.name.chinese }}</h2>
        <img :src="getImageUrl(character2.image)" alt="Character 2 Image">
        <ul class="character-stats">
          <li>HP: {{ character2CurrentHP }} / {{ character2.base.HP }}</li>
          <li>Attack: {{ character2.base.Attack }}</li>
          <li>Defense: {{ character2.base.Defense }}</li>
          <li>Speed: {{ character2.base.Speed }}</li>
        </ul>
        <button @click="attackCharacter1">Attack</button>
      </div>
    </div>

    <!-- Battle Log -->
    <div v-if="battleLog" class="battle-log">
      <p>{{ battleLog }}</p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
  <script>
    new Vue({
      el: '#app',
      data: {
        character1Id: '',
        character2Id: '',
        character1: null,
        character2: null,
        character1CurrentHP: 0,
        character2CurrentHP: 0,
        showCharacterBox: false,
        battleLog: '',
        battleFinished: false,
        showInputBox: true
      },
      computed: {
        character1HPPercentage() {
          return ((this.character1CurrentHP / this.character1.base.HP) * 100).toFixed(2);
        },
        character2HPPercentage() {
          return ((this.character2CurrentHP / this.character2.base.HP) * 100).toFixed(2);
        }
      },
      methods: {
        async fetchCharacters() {
          try {
            const response = await fetch('/api');
            const data = await response.json();

            this.character1 = data.find(c => c.id == this.character1Id);
            this.character2 = data.find(c => c.id == this.character2Id);

            if (!this.character1 || !this.character2) {
              alert('Character not found!');
              return;
            }

            this.character1CurrentHP = this.character1.base.HP;
            this.character2CurrentHP = this.character2.base.HP;

            this.showCharacterBox = false;
            this.battleFinished = false;
            this.battleLog = ''; // Reset the battle log
            setTimeout(() => {
              this.showCharacterBox = true;
              this.showInputBox = false;
            }, 2000);
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        getImageUrl(imagePath) {
          return `http://localhost:8080${imagePath}`;
        },
        attackCharacter1() {
          if (this.battleFinished) return;
          
          const damageToCharacter1 = this.calculateDamage(this.character2.base.Attack, this.character1.base.Defense);
          this.character1CurrentHP = Math.max(0, this.character1CurrentHP - damageToCharacter1);
          this.battleLog = `${this.character2.name.chinese} attacks! ${this.character1.name.chinese} takes ${damageToCharacter1} damage!\n`;

          if (this.character1CurrentHP === 0) {
            this.battleLog = `${this.character1.name.chinese} has fainted! ${this.character2.name.chinese} wins!\n`;
            this.battleFinished = true;
            return;
          }
        },
        attackCharacter2() {
          if (this.battleFinished) return;

          const damageToCharacter2 = this.calculateDamage(this.character1.base.Attack, this.character2.base.Defense);
          this.character2CurrentHP = Math.max(0, this.character2CurrentHP - damageToCharacter2);
          this.battleLog = `${this.character1.name.chinese} attacks! ${this.character2.name.chinese} takes ${damageToCharacter2} damage!\n`;

          if (this.character2CurrentHP === 0) {
            this.battleLog = `${this.character2.name.chinese} has fainted! ${this.character1.name.chinese} wins!\n`;
            this.battleFinished = true;
            return;
          }
        },
        calculateDamage(attack, defense) {
          // Simple damage formula: attack - defense + base damage
          return Math.max(0, attack - defense + 10);
        }
      }
    });
  </script>
</body>
</html>